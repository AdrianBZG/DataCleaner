<ui:composition template="template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<ui:define name="head">
		<script type="text/javascript" language="javascript"
			src="scheduling/scheduling.nocache.js" />
		<script type="text/javascript" language="javascript"
			src="wizard/wizard.nocache.js" />
		<c:if test="#{user.scheduleEditor}">
			<script type="text/javascript">
				//<![CDATA[
				var datacleaner = {
					onApiInitialized : function() {
						$(document).ready(function() {
							// check if wizard needs to start immediately
							var hashPartOfUri = window.location.hash;
							if (hashPartOfUri == "#startWizard") {
								datacleaner.startJobWizard();
								window.location.hash = "";
							}
						});
					}
				}

				function confirmUpload(file, fileType) {
					if (file.value) {
						if (confirm('Are you sure you wish to upload the '
								+ fileType
								+ ' file?\nUploading a corrupt file may cause system ineffeciencies or even crashes.')) {
							return true;
						}
						return false;
					} else {
						alert('Please choose a ' + fileType
								+ ' file to upload.');
						return false;
					}
				}

				function showUploadJobForm(button) {
					var form = button.form;
					form.innerHTML = '<div>'+
						'<div>Upload job file</div>'+
						'<div><span class="btn btn-default btn-file">Browse <input type="file" name="file" /></span>' + 
						'<button type="submit" class="btn btn-warning" onclick="return confirmUpload(\'job\')"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span><span>Upload</span></button>' + 
						'</div></div>';
				}
				//]]>
			</script>
		</c:if>
	</ui:define>

	<ui:define name="content">
		<div id="SchedulingPage" class="container">
			<c:if test="#{user.scheduleEditor}">
				<div class="btn-group">
					<button class="btn btn-primary"
						onclick="datacleaner.startJobWizard();">
						<span class="glyphicon glyphicon-plus" aria-hidden="true" /> <span>Build
							job</span>
					</button>
				</div>
				<form action="repository/#{user.tenant}/jobs/#{file.name}"
					method="post" enctype="multipart/form-data" style="display: inline"
					id="uploadJobs">
					<button class="btn btn-default" onclick="showUploadJobForm(this)">
						<span class="glyphicon glyphicon-upload" aria-hidden="true" /> <span>Upload
							job</span>
					</button>
				</form>

				<div class="spacer"></div>
			</c:if>

			<div id="RootPanelTarget"></div>
		</div>
	</ui:define>

</ui:composition>


